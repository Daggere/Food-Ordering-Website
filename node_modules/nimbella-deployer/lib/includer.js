"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeIncluder=void 0;const makeDebug=require("debug"),debug=makeDebug("nim:deployer:includer");function makeIncluder(e,s){const t=e?e.split(","):void 0,i=s?s.split(","):void 0,d=new IncluderImpl(t,i);return debug("constructed includer: %O",d),d}exports.makeIncluder=makeIncluder;class IncluderImpl{constructor(e,s){if(this.isWebIncluded=!1,this.startWithAllIncluded=!1,this.includedPackages=new Set,this.excludedPackages=new Set,this.includedActions=new Map,this.excludedActions=new Map,this.isPackageIncluded=e=>{const s=(this.startWithAllIncluded||this.includedPackages.has(e))&&!this.excludedPackages.has(e);return debug("isPackageIncluded(%s)=%s",e,String(s)),s},this.isActionIncluded=(e,s)=>!!this.isActionInMap(e,s,this.includedActions)||!this.excludedPackages.has(e)&&!this.isActionInMap(e,s,this.excludedActions)&&(this.startWithAllIncluded||this.includedPackages.has(e)),this.isIncludingEverything=()=>this.startWithAllIncluded&&0===this.includedActions.size&&0===this.includedPackages.size,e)for(let s of e){if("web"===s){this.isWebIncluded=!0;continue}s.endsWith("/")&&(s=s.slice(0,-1));const[e,t]=s.split("/");t?this.addToMap(e,t,this.includedActions):this.includedPackages.add(e)}else this.isWebIncluded=!0,this.startWithAllIncluded=!0;if(s)for(let e of s){if("web"===e){this.isWebIncluded=!1;continue}e.endsWith("/")&&(e=e.slice(0,-1));const[s,t]=e.split("/");t?this.addToMap(s,t,this.excludedActions):this.excludedPackages.add(s)}}addToMap(e,s,t){let i=t.get(e);i||(i=new Set,t.set(e,i)),i.add(s)}isActionInMap(e,s,t){const i=t.get(e);return!!i&&i.has(s)}}
